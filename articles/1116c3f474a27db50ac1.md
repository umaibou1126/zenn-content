---
title: "ã€CentOSã€‘NFSãƒã‚¦ãƒ³ãƒˆ ã‚³ãƒãƒ³ãƒ‰ã¾ã¨ã‚"
emoji: "ğŸ‘»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [ã‚¤ãƒ³ãƒ•ãƒ©, CentOS, NFS]
published: true
---


# NFSãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰

 - exportfsï¼šãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ å†…ã®**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
 - no_root_squashï¼šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®rootã‚¢ã‚¯ã‚»ã‚¹ã‚’**ã‚µãƒ¼ãƒä¸Šã«ã‚‚é©ç”¨**ã™ã‚‹

|ã‚ªãƒ—ã‚·ãƒ§ãƒ³|è©³ç´°|
|:--:|:--:|
|rw|èª­ã¿è¾¼ã¿ã€æ›¸ãè¾¼ã¿ã‚’**ä¸¡æ–¹è¨±å¯**ã™ã‚‹|
|ro|**èª­ã¿è¾¼ã¿ã«é™ã‚Š**ã€è¨±å¯ã™ã‚‹|
|sync|**åŒæœŸæ›¸ãè¾¼ã¿**ã‚’æœ‰åŠ¹ã«ã™ã‚‹|
|async|**éåŒæœŸæ›¸ãè¾¼ã¿**ã‚’æœ‰åŠ¹ã«ã™ã‚‹|
#### â—† mountã‚³ãƒãƒ³ãƒ‰

```
//serverIPã‚¢ãƒ‰ãƒ¬ã‚¹, ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆã‚’æŒ‡å®š
$ mount -F 192.168.0.2:/nfs /tmp/sample
```

# ãƒ‡ã‚£ã‚¹ã‚¯ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
 - partedã‚³ãƒãƒ³ãƒ‰ï¼šãƒ‡ã‚£ã‚¹ã‚¯ã‚’``ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³åˆ†å‰²``ã™ã‚‹éš›ã«ä½¿ç”¨ã™ã‚‹ <br>
 â€» ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ç®¡ç†æ–¹å¼ã¨ã—ã¦``MBR``ã¨``GBT``ãŒã‚ã‚‹ <br>
 â€» ``fdiskã‚³ãƒãƒ³ãƒ‰``ã¯ã€``MBRæ–¹å¼``ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³é™å®š

#### â—† partedã‚³ãƒãƒ³ãƒ‰

```
//parted <ãƒ‡ãƒã‚¤ã‚¹å>
$ parted /dev/sdb

//ä¼šè©±å½¢å¼ã§ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æ–¹å¼ã‚’é¸æŠã™ã‚‹
(parted) mklabel gpt
```



# Firewallã®è¨±å¯è¨­å®š
 - FireWallã®è¨­å®šä¸Šã€```zone```ã¨```service```ã®è¨­å®šãŒå¿…é ˆ
 - permanentï¼š```æ’ä¹…çš„```
 - DMZï¼š```éæ­¦è£…åœ°å¸¯```ã€€å¤–éƒ¨NWã¨å†…éƒ¨NWã‚’``Firewall``ã«ã‚ˆã£ã¦éš”é›¢ã•ã‚Œã¦ã„ã‚‹
 - eth0ï¼š``NIC``(ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã‚«ãƒ¼ãƒ‰)ã®ï¼‘ã¤ã€‚``ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆé€šä¿¡``ã®ã¿å¯èƒ½


#### â—† firewall zoneä¸€è¦§
|zone|è©³ç´°|
|:--:|:--|
|public|**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**ã§è¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒ«ãƒ¼ãƒ«|
|work|**ä¼šç¤¾**ã§è¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒ«ãƒ¼ãƒ«|
|home|**å®¶åº­**ã§è¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒ«ãƒ¼ãƒ«|
|internal|**å†…éƒ¨NW**ã§Firewallã‚’æ§‹ç¯‰ã™ã‚‹éš›ã«ä½¿ç”¨ã™ã‚‹ãƒ«ãƒ¼ãƒ«|
|external|**å¤–éƒ¨NW**ã§Firewallã‚’æ§‹ç¯‰ã™ã‚‹éš›ã«ä½¿ç”¨ã™ã‚‹ãƒ«ãƒ¼ãƒ«|
|DMZ|**DMZ**ã§Firewallã‚’æ§‹ç¯‰ã™ã‚‹éš›ã«ä½¿ç”¨ã™ã‚‹ãƒ«ãƒ¼ãƒ«|

#### â—† firewallã‚³ãƒãƒ³ãƒ‰
```
//zone, serviceã‚’å„ã€…è¿½åŠ ã™ã‚‹
$ firewall-cmd --permanent --zone=public --add-service=nfs

//FWè¨­å®šã‚’åæ˜ ã™ã‚‹
$ firewall-cmd --reload

//FWä¸Šã®serviceä¸€è¦§ã‚’ç¢ºèª
$ firewall-cmd --list-all
```

# RPCè¨­å®š

 - RPCï¼š```Remote Procedure Call```ã®ç•¥ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’è·¨ã„ã å‡¦ç†ã®éš›ã«ã€```ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚Šã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ã‘å–ã‚‹``æµã‚Œã®ã“ã¨

#### â—† rpcbindé–¢é€£ã‚³ãƒãƒ³ãƒ‰
```
//rpcbind.serviceã‚’èµ·å‹•ã™ã‚‹
$ systemctl start rpcbind.service

//rpcbind.serviceã‚’è¨±å¯ã™ã‚‹
$ systemctl enable rpcbind.service

//rpcbind.serviceã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç¢ºèªã™ã‚‹
$ systemctl status rpcbind.service
```

#### â—† rpcbind.socketè¨­å®šä¾‹

```:/etc/systemd/system/rpcbind.socket
[Unit]
Description=RPCbind Server Activation Socket

[Socket]
ListenStream=/var/run/rpcbind.sock
ListenStream=111
# ListenStream=[::]:111     //ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
# ListenStream=0.0.0.0:111  //ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
# BindIPv6Only=ipv6-only ã€€ã€€//ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ

[Install]
WantedBy=sockets.target
```

#### â—† rpcbind.socketè¨­å®šåæ˜ ã‚³ãƒãƒ³ãƒ‰

```
//rpcbind.socketã®å†…å®¹ã‚’åæ˜ ã™ã‚‹
$ systemctl daemon-reload

//NFSã‚µãƒ¼ãƒã‚’èµ·å‹•ã™ã‚‹
$ systemctl start nfs-server

//NFSã‚µãƒ¼ãƒã‚’è¨±å¯ã™ã‚‹
$ systemctl enable nfs-server
```








# å‚è€ƒæ–‡çŒ®

 - [5åˆ†ã§çµ‚ã‚ã‚‰ã›ã‚‹NFSãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰](https://qiita.com/rikudai/items/f9900e4865ce25a8464e)
 - [exportfs](https://linuxjm.osdn.jp/html/nfs-utils/man8/exportfs.8.html)
 - [Linux NFSã‚µãƒ¼ãƒã®è¨­å®š](http://www.kuromogu.com/ha/comp/sw/soft_linux_nfs.html)
 - [CentOS 7 firewalld ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰](https://qiita.com/kenjjiijjii/items/1057af2dddc34022b09e)
 - [ãã‚‚ãã‚‚ RPC ã£ã¦ãªã‚“ã ](https://qiita.com/il-m-yamagishi/items/8709de06be33e7051fd2)
 - [NFSãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®è‡ªå‹•ãƒã‚¦ãƒ³ãƒˆï¼ˆCentOS7ï¼‰](http://www.sebegginer.com/article/449338938.html)
 - [parted ã‚³ãƒãƒ³ãƒ‰ã«ã¤ã„ã¦](https://qiita.com/centipede/items/ae181fcb76f549514918)
 - [NFS : ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š](https://www.server-world.info/query?os=CentOS_8&p=nfs&f=1)
 - [[Linux] firewalldã§firewallã®è¨­å®šã‚’ã™ã‚‹](https://qiita.com/suzutsuki0220/items/4a62cc0e676a80ed79f1)
 - [DMZã¨ã¯](https://it-trend.jp/words/dmz)
 - [2.14 ä»®æƒ³ã‚µãƒ¼ãƒã®NICï¼ˆeth0ã€eth1ã€eth2ï¼‰ã§å¯èƒ½ãªé€šä¿¡ã‚’çŸ¥ã‚ŠãŸã„](https://manual.iij.jp/gp/gpcp/f-2-14.html)
