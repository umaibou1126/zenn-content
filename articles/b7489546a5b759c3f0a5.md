---
title: "LINE BOTã§å½¼å¥³botã‚’ä½œã‚ŠãŸã„"
emoji: "ğŸ”¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Line", "linebot", "Go", "Heroku", "å€‹äººé–‹ç™º"]
published: true
---

# ã¯ã˜ã‚ã«
å¯‚ã—ã„æ™‚ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿”ã—ã¦ãã‚Œã‚‹**å½¼å¥³é¢¨LINE BOT**ã‚’ä½œã‚Šã¾ã—ãŸã€‚

[![Image from Gyazo](https://i.gyazo.com/15fc3c4478ec6a72eba279cff0f8cb9e.png)](https://gyazo.com/15fc3c4478ec6a72eba279cff0f8cb9e)

#### QRã‚³ãƒ¼ãƒ‰

[![Image from Gyazo](https://i.gyazo.com/f22a26304e7bc0755cd4f4a95b1d2cd2.png)](https://gyazo.com/f22a26304e7bc0755cd4f4a95b1d2cd2)

#### ä½¿ç”¨æŠ€è¡“
 - Go
 - line-bot-sdk
 - heroku

# äº‹å‰æº–å‚™
LINE Developersç™»éŒ² - LINE BOTã®ä½œæˆã¾ã§ã¯ã€ä»¥ä¸‹ã‚¬ã‚¤ãƒ‰ã‚’å‚è€ƒã«è‡´ã—ã¾ã—ãŸã€‚
 - [Messaging APIã‚’å§‹ã‚ã‚ˆã†](https://developers.line.biz/ja/docs/messaging-api/getting-started/)
 - [ãƒœãƒƒãƒˆã‚’ä½œæˆã™ã‚‹](https://developers.line.biz/ja/docs/messaging-api/building-bot/)

# Herokuæº–å‚™

#### ã‚¢ãƒ—ãƒªä½œæˆ

```
$ heroku login
$ heroku create sample-bot
$ heroku git:remote -a sample-bot
```

#### LINE ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ&& ãƒˆãƒ¼ã‚¯ãƒ³ã‚’Herokuã«è¨­å®š

 - LINE Developers > Basic settings > Channel secret

[![Image from Gyazo](https://i.gyazo.com/b1fe62c0bde53069254a940dd27a325c.png)](https://gyazo.com/b1fe62c0bde53069254a940dd27a325c)

 - LINE Developers > Messaging API > Channel access token

[![Image from Gyazo](https://i.gyazo.com/cdf93a8ae01e9099c7adcce8f10c5de6.png)](https://gyazo.com/cdf93a8ae01e9099c7adcce8f10c5de6)

 - Herokuã‚¢ãƒ—ãƒªè¨­å®š

```
$ heroku config:set CHANNEL_SECRET=XXXXXXXXXX --app sample-bot
$ heroku config:set CHANNEL_TOKEN=XXXXXXXXXX --app sample-bot
```

#### Webhook URLç™»éŒ²

 - LINE Developers > Messaging API > Webhook settings

[![Image from Gyazo](https://i.gyazo.com/270c5c05330554eca80bea1b7476e9c9.png)](https://gyazo.com/270c5c05330554eca80bea1b7476e9c9)

# Botä½œæˆ

#### Goãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæº–å‚™

```
$ mkdir sample-bot && cd sample-bot
$ go mod init github.com/GitHubãƒ¦ãƒ¼ã‚¶å/GitHubãƒªãƒã‚¸ãƒˆãƒªå
```

#### Goãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
$ go get github.com/line/line-bot-sdk-go/linebot
$ go get github.com/gin-gonic/gin
```

#### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

```main.go
package main

import (
	"log"
	"os"
	"strings"

	"github.com/gin-gonic/gin"

	"github.com/line/line-bot-sdk-go/linebot"
)

func main() {
	port := os.Getenv("PORT")

	if port == "" {
		log.Fatal("$PORT must be set")
	}
	bot, err := linebot.New(
		"LINE ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼ˆä¸Šè¨˜å‚ç…§ï¼‰",
		"LINE ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆä¸Šè¨˜å‚ç…§ï¼‰",
	)
	if err != nil {
		log.Fatal(err)
	}

	router := gin.New()
	router.Use(gin.Logger())

	// LINE Messaging API ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
	router.POST("/callback", func(c *gin.Context) {
		events, err := bot.ParseRequest(c.Request)
		if err != nil {
			if err == linebot.ErrInvalidSignature {
				log.Print(err)
			}
			return
		}

		// "å¯æ„›ã„" å˜èªã‚’å«ã‚€å ´åˆã€è¿”ä¿¡ã•ã‚Œã‚‹
		var replyText string
		replyText = "å¯æ„›ã„"

		// ãƒãƒ£ãƒƒãƒˆã®å›ç­”
		var response string
		response = "ã‚ã‚ŠãŒã¨ã†ï¼ï¼"

		// "ãŠã¯ã‚ˆã†" å˜èªã‚’å«ã‚€å ´åˆã€è¿”ä¿¡ã•ã‚Œã‚‹
		var replySticker string
		replySticker = "ãŠã¯ã‚ˆã†"

		// ã‚¹ã‚¿ãƒ³ãƒ—ã§å›ç­”ãŒæ¥ã‚‹
		responseSticker := linebot.NewStickerMessage("11537", "52002757")

		// "çŒ«" å˜èªã‚’å«ã‚€å ´åˆã€è¿”ä¿¡ã•ã‚Œã‚‹
		var replyImage string
		replyImage = "çŒ«"

		// çŒ«ã®ç”»åƒãŒè¡¨ç¤ºã•ã‚Œã‚‹
		responseImage := linebot.NewImageMessage("https://i.gyazo.com/2db8f85c496dd8f21a91eccc62ceee05.jpg", "https://i.gyazo.com/2db8f85c496dd8f21a91eccc62ceee05.jpg")

		// "ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼" å˜èªã‚’å«ã‚€å ´åˆã€è¿”ä¿¡ã•ã‚Œã‚‹
		var replyLocation string
		replyLocation = "ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼"

		// ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãŒåœ°å›³è¡¨ç¤ºã•ã‚Œã‚‹
		responseLocation := linebot.NewLocationMessage("æ±äº¬ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãƒ©ãƒ³ãƒ‰", "åƒè‘‰çœŒæµ¦å®‰å¸‚èˆæµœ", 35.632896, 139.880394)

		for _, event := range events {
			// ã‚¤ãƒ™ãƒ³ãƒˆãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—ä¿¡ã ã£ãŸå ´åˆ
			if event.Type == linebot.EventTypeMessage {
				switch message := event.Message.(type) {
				// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã®å ´åˆ
				case *linebot.TextMessage:
					replyMessage := message.Text
					// ãƒ†ã‚­ã‚¹ãƒˆã§è¿”ä¿¡ã•ã‚Œã‚‹ã‚±ãƒ¼ã‚¹
					if strings.Contains(replyMessage, replyText) {
						bot.ReplyMessage(event.ReplyToken, linebot.NewTextMessage(response)).Do()
						// ã‚¹ã‚¿ãƒ³ãƒ—ã§è¿”ä¿¡ã•ã‚Œã‚‹ã‚±ãƒ¼ã‚¹
					} else if strings.Contains(replyMessage, replySticker) {
						bot.ReplyMessage(event.ReplyToken, responseSticker).Do()
						// ç”»åƒã§è¿”ä¿¡ã•ã‚Œã‚‹ã‚±ãƒ¼ã‚¹
					} else if strings.Contains(replyMessage, replyImage) {
						bot.ReplyMessage(event.ReplyToken, responseImage).Do()
						// åœ°å›³è¡¨ç¤ºã•ã‚Œã‚‹ã‚±ãƒ¼ã‚¹
					} else if strings.Contains(replyMessage, replyLocation) {
						bot.ReplyMessage(event.ReplyToken, responseLocation).Do()
					}
					// ä¸Šè¨˜æ„å¤–ã¯ã€ãŠã†ã‚€è¿”ã—ã§è¿”ä¿¡
					_, err = bot.ReplyMessage(event.ReplyToken, linebot.NewTextMessage(replyMessage)).Do()
					if err != nil {
						log.Print(err)
					}
				}
			}
		}
	})
	router.Run(":" + port)
}
```

#### Herokuãƒ‡ãƒ—ãƒ­ã‚¤

```
$ git add -A
$ git commit -m "create sample-bot"
$ git push heroku main
```

# å‚è€ƒæ–‡çŒ®
 - [Goãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã¯ã˜ã‚ã‹ãŸã¨ãŠã™ã™ã‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒª8.5é¸ã€‚ã²ãªå½¢ã«ã‚‚ä½¿ãˆã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚‚ã‚ã‚‹ã‚ˆã€‚
](https://qiita.com/yagi_eng/items/65cd812107362d36ae86)
 - [åƒè‘‰çœŒæ±äº¬ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãƒ©ãƒ³ãƒ‰](http://www.geocoding.jp/?q=%E5%8D%83%E8%91%89%E7%9C%8C%E6%9D%B1%E4%BA%AC%E3%83%87%E3%82%A3%E3%82%BA%E3%83%8B%E3%83%BC%E3%83%A9%E3%83%B3%E3%83%89)
 - [Golangã§Line APIã‚’ã„ã˜ãã‚‹ã‚ˆ](https://blog.kazu634.com/labs/golang/2019-02-23-line-sdk-go/)
