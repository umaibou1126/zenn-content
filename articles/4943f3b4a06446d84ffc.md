---
title: "Firebase Cloud Functions Ã— TypeScript"
emoji: "ğŸ™Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [TypeScript, Firebase, cloudfunctions, CloudFirestore]
published: true
---

## Firebase CLI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```
$ npm install -g firebase-tools
```

## Firebase ãƒ­ã‚°ã‚¤ãƒ³
```
$ firebase login
```

## Firebase Cloud Functions
```
$ firebase init functions
```

## ESLintãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```
$ npm install --save-dev eslint @typescript-eslint/eslint-plugin @typescript-eslint/parser prettier eslint-config-prettier eslint-plugin-prettier
```

## .eslintrc.json
```:.eslintrc.json
{
  "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/eslint-recommended",
    "plugin:@typescript-eslint/recommended",
    "plugin:prettier/recommended",
    "prettier/@typescript-eslint"
  ],
  "plugins": [
    "@typescript-eslint"
  ],
  "env": { "node": true, "es6": true },
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "sourceType": "module",
    "project": "./tsconfig.json"
  },
  "rules": {
  }
}
```

## Linter å®Ÿè¡Œ
```
$ npm run lint:fix
$ npm run lint
```

## onUpdateé–¢æ•°
```index.ts
import * as functions from "firebase-functions";
import * as admin from "firebase-admin";

/**
cloudFirestore è¨­å®š
*/
admin.initializeApp(functions.config().firebase);
const f = functions.region("us-central1");

/**
onUpdateé–¢æ•° è¨­å®š
*/
export const onUpdate =
  f.firestore.document("test/test1")
      .onUpdate(async (change, context) => {
        const data = change.after.data();
        const sample = data.sample;

        const ansRef = sample.replace(/\r?\n/g, "");

        return change.after.ref.set({
          sample: ansRef,
        }, {merge: true});
      });
```

## ãƒ‡ãƒ—ãƒ­ã‚¤
```
$ npm run deploy
```

## å‚è€ƒæ–‡çŒ®
 - [ã€Flutterã€‘(ã¯ã˜ã‚ã¦)Cloud Functions for Firebaseã‚’ä½¿ã£ã¦Firestoreã®ãƒ‡ãƒ¼ã‚¿ã‚’å®šæœŸçš„ã«æ›´æ–°ã—ã¦ã¿ãŸ](https://qiita.com/yusuke_vp/items/39f5f15bbca32998a127)
 - [Cloud Functions ã‚’ TypeScript ã§æ›¸ã](https://qiita.com/star__hoshi/items/7dcf5970d28a7ff239fb)
 - [è„±TSLintã—ã¦ã€ESLint TypeScript Plugin ã«ç§»è¡Œã™ã‚‹](https://qiita.com/suzuki_sh/items/fe9b60c4f9e1dbc5d903)
 - [Cloud functions + typescriptã§ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã‚’è¡Œã†æ–¹æ³•ï¼ˆã‚ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ”¹å–„ã¨ã‹ï¼‰](https://qiita.com/gaku3601/items/4c887f30804ce8c83cbe)
 - [CloudFunctionsã‚’ãã‚Œã„ã«æ•´ç†ã—ãŸã„ã€‚](https://qiita.com/1amageek/items/b93f8e4d99e3b6f423aa)
 - [æ”¹è¡Œã‚’ã™ã¹ã¦å‰Šé™¤ã™ã‚‹](https://javascript.step-learn.com/contents/J058-rn-delete.html)
 - [Cloud Firestore ãƒˆãƒªã‚¬ãƒ¼](https://firebase.google.com/docs/functions/firestore-events?hl=ja)
